<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lottery Picker</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body{
      display:grid; place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:#0b0b0b; color:#f5f5f5;
    }
    .wrap{ width:min(520px, 92vw); text-align:center; padding:24px; }
    h1{ margin:0 0 14px; font-size: clamp(22px, 5vw, 32px); opacity:.9; font-weight:700; }
    .card{ background:#121212; border:1px solid #222; border-radius:16px; padding:16px; margin: 12px 0; }
    .row{ display:flex; gap:10px; }
    .row > div{ flex:1; }
    label{ display:block; text-align:left; font-size:14px; opacity:.75; margin: 10px 0 6px; }
    input{
      width:100%; box-sizing:border-box;
      padding:14px 12px; border-radius:14px;
      border:1px solid #2a2a2a; background:#0b0b0b; color:#f5f5f5;
      font-size:18px;
    }
    .btn{
      width:100%;
      border:0;
      color:#0b0b0b;
      background:#f5f5f5;
      padding:16px 14px;
      border-radius:16px;
      font-size:18px;
      font-weight:750;
      margin-top: 12px;
      cursor:pointer;
      transition: transform 120ms ease;
    }
    .btn:active{ transform: translateY(1px); }

    .btn.secondary{
      background:#1c1c1c;
      color:#f5f5f5;
      border:1px solid #2a2a2a;
      font-weight:700;
    }
    .btnrow{
      display:flex;
      gap:10px;
      margin-top: 12px;
    }
    .btnrow .btn{ margin-top:0; }
    .out{
      margin-top: 14px;
      font-size: clamp(18px, 5vw, 26px);
      font-weight: 800;
      letter-spacing: .5px;
      min-height: 40px;
      word-spacing: 10px;
      user-select: text;
    }
    .hint{ margin-top:14px; font-size:14px; opacity:.55; }
    .toast{
      margin-top: 10px;
      font-size: 13px;
      opacity: .75;
      min-height: 18px;
    }
    a.back{ display:inline-block; margin-top: 16px; color:#f5f5f5; opacity:.7; text-decoration:none; }

    /* --- subtle animations --- */
    @keyframes popIn {
      0%   { transform: translateY(6px) scale(0.98); opacity: 0; }
      100% { transform: translateY(0)   scale(1);    opacity: 1; }
    }
    @keyframes shimmer {
      0%   { opacity: .35; }
      100% { opacity: 1; }
    }
    .out.anim { animation: popIn 220ms ease-out; }
    .out.loading { animation: shimmer 120ms ease-in-out infinite alternate; opacity:.7; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Lottery picker</h1>

    <div class="card">
      <label for="count">How many numbers?</label>
      <input id="count" inputmode="numeric" value="6" />

      <div class="row">
        <div>
          <label for="min">Min</label>
          <input id="min" inputmode="numeric" value="1" />
        </div>
        <div>
          <label for="max">Max</label>
          <input id="max" inputmode="numeric" value="49" />
        </div>
      </div>

      <div class="btnrow">
        <button class="btn" id="go">Pick</button>
        <button class="btn secondary" id="copy" disabled>Copy</button>
      </div>

      <div class="out" id="out">—</div>
      <div class="toast" id="toast"></div>
      <div class="hint">Unique picks (no repeats). Tap again to repick.</div>
    </div>

    <a class="back" href="./index.html">← Back</a>
  </div>

  <script>
    function toInt(v){
      const n = parseInt(String(v).trim(), 10);
      return Number.isFinite(n) ? n : NaN;
    }

    function randInt(min, max){
      const range = max - min + 1;
      if (range <= 0) throw new Error("bad range");

      if (window.crypto && crypto.getRandomValues){
        const arr = new Uint32Array(1);
        const maxUnbiased = Math.floor(0xFFFFFFFF / range) * range - 1;
        let x;
        do {
          crypto.getRandomValues(arr);
          x = arr[0];
        } while (x > maxUnbiased);
        return min + (x % range);
      }
      return min + Math.floor(Math.random() * range);
    }

    function sampleUnique(min, max, k){
      const n = max - min + 1;
      if (k > n) throw new Error("k too large");

      const pool = [];
      for (let i=0;i<n;i++) pool.push(min+i);

      for (let i=0;i<k;i++){
        const j = i + randInt(0, n - i - 1);
        [pool[i], pool[j]] = [pool[j], pool[i]];
      }
      return pool.slice(0,k).sort((a,b)=>a-b);
    }

    const out = document.getElementById("out");
    const toast = document.getElementById("toast");
    const copyBtn = document.getElementById("copy");
    const goBtn = document.getElementById("go");

    function setToast(msg){
      toast.textContent = msg;
      if (msg) setTimeout(() => { toast.textContent = ""; }, 1400);
    }

    function currentText(){
      const t = out.textContent.trim();
      return (t && t !== "—" && !t.includes("Enter") && !t.includes("Invalid") && !t.includes("Range"))
        ? t
        : "";
    }

    function updateCopyState(){
      copyBtn.disabled = !currentText();
    }

    function setBusy(isBusy){
      goBtn.disabled = isBusy;
      goBtn.style.opacity = isBusy ? "0.85" : "1";
      goBtn.style.cursor = isBusy ? "default" : "pointer";
    }

    document.getElementById("go").addEventListener("click", () => {
      const k = toInt(document.getElementById("count").value);
      const a = toInt(document.getElementById("min").value);
      const b = toInt(document.getElementById("max").value);

      if (!Number.isFinite(k) || !Number.isFinite(a) || !Number.isFinite(b)){
        out.textContent = "Enter whole numbers.";
        out.classList.remove("loading","anim");
        setToast("");
        updateCopyState();
        return;
      }
      if (k <= 0){
        out.textContent = "Count must be at least 1.";
        out.classList.remove("loading","anim");
        setToast("");
        updateCopyState();
        return;
      }

      const min = Math.min(a,b);
      const max = Math.max(a,b);

      // --- subtle shuffle effect ---
      setBusy(true);
      out.classList.remove("anim");
      out.classList.add("loading");
      setToast("");

      const shuffleMs = 320;
      const endAt = performance.now() + shuffleMs;

      const tick = () => {
        // dummy numbers during shuffle (never more than 12 so it doesn't look messy)
        try {
          const cap = Math.min(k, Math.max(1, Math.min(12, (max - min + 1))));
          const dummy = sampleUnique(min, max, cap);
          out.textContent = dummy.join(" ");
        } catch (_) {}

        if (performance.now() < endAt) {
          requestAnimationFrame(tick);
          return;
        }

        // final result
        out.classList.remove("loading");
        out.classList.add("anim");

        try{
          const nums = sampleUnique(min, max, k);
          out.textContent = nums.join(" ");
          setToast("");
        } catch {
          const size = max - min + 1;
          out.textContent = (size < k)
            ? `Range too small for ${k} picks.`
            : "Invalid settings.";
        }

        updateCopyState();
        setTimeout(() => out.classList.remove("anim"), 260);
        setBusy(false);
      };

      requestAnimationFrame(tick);
    });

    // Copy to clipboard (with fallback)
    copyBtn.addEventListener("click", async () => {
      const text = currentText();
      if (!text) return;

      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
          setToast("Copied!");
          return;
        }
      } catch (_) {}

      // Fallback for older/permission-restricted browsers
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.setAttribute("readonly", "");
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      try {
        document.execCommand("copy");
        setToast("Copied!");
      } catch {
        setToast("Copy failed — hold to select.");
      }
      document.body.removeChild(ta);
    });

    updateCopyState();
  </script>
</body>
</html>
